management:
  endpoints:
    web:
      exposure:
        include: '*'
spring:
  application:
    name: test-server
server:
  port: 1111
  connectionTimeout: 30000
  tomcat:
    basedir: ./tmp
    accesslog:
      enabled: true
      pattern: '%t %a "%r" %s (%D ms)'
    maxThreads: 100
    minSpareThreads: 20
eureka:
  client:
    serviceUrl:
      defaultZone: http://localhost:8761/eureka/
hystrix:
  command:
    #可以指定特定的服务代替default
    default:
      circuitBreaker:
        # 是否开启熔断(默认true)
        enabled: true
        # 熔断生效至少请求数量(默认20),当同一HystrixCommand请求数量低于此值时,熔断不会开启
        requestVolumeThreshold: 20
        # 失败次数超过比例才开启熔断
        errorThresholdPercentage: 50
        #半开试探休眠时间，默认值5000ms。当熔断器开启一段时间之后比如5000ms，会尝试放过去一部分流量进行试探，确定依赖服务是否恢复
        sleepWindowInMilliseconds: 5000
        # 强制开启熔断
        #forceOpen： true
        # 强制关闭熔断
        #forceClosed: true
      execution:
        isolation:
          # THREAD:单独开启线程执行;SEMAPHORE:在调用线程上执行(由于我们现有框架中FeignUserContextInterceptor中使用了ThreadLocal,所以必须使用第二种方式)
          strategy: SEMAPHORE
          thread:
            # 执行超时时间(这个时间设置很重要,因为HystrixCommand会包装RibbonClient实例,那么这个时间就必须要大于ribbon timeout * retry,后面Ribbon章节会介绍)
            timeoutInMilliseconds: 2500
          semaphore:
            # 由于我们使用SEMAPHORE模式,当每个feign并发发起请求超过此值时,请求会被拒绝,直接调用降级方法,异常信息关键字:could not acquire a semaphore for execution
            maxConcurrentRequests: 1000
      fallback:
        isolation:
          semaphore:
            # 由于我们使用SEMAPHORE模式，当每个feign并发发起请求调用降级方法超过此值,调用降级方法会被拒绝,直接抛出异常,异常信息关键字:fallback execution rejected
            maxConcurrentRequests: 1000
test-service:
  ribbon:
    #负载均衡策略(默认轮询方式,参考IRule接口的实现类)
    NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule
    # 默认相同的route不重试,可以避免一些各种重试引起的问题，简单化(但服务提供方还是应该尽量保证幂等性)
    MaxAutoRetries: 0
    # 默认只重试不同route一次
    MaxAutoRetriesNextServer: 1
    # 默认5000
    ReadTimeout: 5000
    # 默认2000
    ConnectTimeout: 2000
    # ribbon子容器饥饿加载,避免偶尔因为服务重启后第一次发起请求时延迟加载耗时造成fallback,但是会增加系统启动时间(新版才支持)
    eager-load:
      enabled: true
      clients: user-server,config-server